exports.id=645,exports.ids=[645],exports.modules={78466:(e,t,o)=>{Promise.resolve().then(o.bind(o,53754))},53754:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>M});var n,s=o(53854),r=o(79636),a=o(65805);let l=({startGame:e,resetGame:t,undoMove:o,forfeitGame:n})=>(0,s.jsxs)("div",{className:"flex gap-4 mt-4",children:[s.jsx(a.z,{className:"w-full",onClick:()=>e(),children:"Start Game"}),s.jsx(a.z,{className:"w-full",onClick:()=>n(),children:"Forfeit"}),s.jsx(a.z,{className:"w-full",onClick:()=>o(),children:"Undo"})]});var i=o(3314),c=o(34218),d=o.n(c),u=o(15656),m=o(94574);function f(e){let{defaultValue:t,name:o}=e,[n,s]=(0,c.useState)(void 0),r=`@stockchess/useLocalStorage/${o}`;return(0,c.useEffect)(function(){if(h()){let e=localStorage.getItem(r);e?s(JSON.parse(e)):s(t)}},[]),(0,c.useEffect)(function(){h()&&void 0!==n&&localStorage.setItem(r,JSON.stringify(n))},[n]),[n??t,s,function(){h()&&localStorage.removeItem(r)}]}function h(){try{if(!window.localStorage||null===localStorage||"undefined"==typeof localStorage||(localStorage.setItem("localStorage:test","value"),"value"!==localStorage.getItem("localStorage:test")))return!1;return localStorage.removeItem("localStorage:test"),!0}catch{return!1}}async function g({gameID:e}){let t=await fetch(`http://fall2324w3g9.int3306.freeddns.org/api/get-timer-info/${e}`,{cache:"no-store"}).then(e=>e.json());return 200===t.status&&t.data?{ok:!0,data:t.data}:{ok:!1,error:t.error??"Get player time left error"}}function p(e,t){return{...e,...t}}function x(e){return 1!==e&&e?new u.qQ("bnnqrkrb/pppppppp/8/8/8/8/PPPPPPPP/BNNQRKRB w KQkq - 0 1"):new u.qQ}!function(e){e.Open="open",e.Connecting="connecting",e.Disconnected="disconnected"}(n||(n={}));let v=({type:e,id:t,userId:o,gameConfig:n})=>{let[s,r]=d().useState(null),[a,l]=d().useState("disconnected"),[i,u]=d().useState((n?.timeMode??0)*6e4),[h,v]=d().useState(!1),[S,w]=d().useState((n?.timeMode??0)*6e4),[k,j]=d().useState(!1),[y,N]=d().useState("unknown"),[b,P]=d().useState(0),[C,O]=d().useState([]),E=d().useCallback(()=>{s?.close(),r(null),l("disconnected")},[s,l]);function R(e){N(e),v(!1),j(!1);let t=Z.history({verbose:!0}),o=[x(n?.variant)];console.log("handle state: ",C);for(let e=0;e<t.length;e++){let s=x(n?.variant);console.log(`tempSate: ${e}`,s.fen());for(let o=0;o<=e;o++)try{s.move(t[o])}catch(e){console.log("[ERR]: ",e)}o.push(s)}O(o),P(o.length-1),E()}d().useEffect(()=>{s&&(s.connect(),s.on("connect",()=>{console.log("Connected",s.id)}),s.on("disconnect",()=>{E()}),s.on("play-chess",async e=>{console.log("Response",e);try{let t=JSON.parse(e);if(t.ok){if(t.move&&U({from:t.move.from,to:t.move.to,promotion:"q"}),3!==t.result.winner){let e=t.result.winner,o=t.result.reason;console.log("Reason: ",o),await new Promise(e=>setTimeout(e,1200)),R(0===e?"draw":1===e?"white":"black")}}else console.error("[!!!] Play chess socket error: ",t.error)}catch(e){console.error("[!!!] Play chess socket error: ",e)}}),s.on("start-game",e=>{console.log("Start game info: ",e);let t=JSON.parse(e);console.log("Given mess: ",t,t.ok),t.ok&&(v(!0),j(!1))}),s.on("end-game",e=>{console.log("clean up state: ",e)}),s.on("user-forfeit",e=>{console.log("user-forfeit socket message: ",e)}),s.on("fetch-saved-game",e=>{try{let t=JSON.parse(e);if(t.ok&&Number.isInteger(t.winner)){console.log("Res win: ",t.winner);let e="unknown";switch(t.winner){case 0:e="draw";break;case 1:e="white";case 2:e="black";default:console.log("Fetched winner: ",t.winner)}"unknown"!==e&&R(e),N(e)}else console.error("[!!!] Error when fetching saved data: ",t.error??"")}catch(e){console.error("[!!!] Can't fetch saved game data")}}))},[E,l,s]),d().useEffect(()=>{z();let e=localStorage.getItem(`@stockchess/useLocalStorage/${t}-moves`);if(e){let t=JSON.parse(e),o=x(n?.variant);console.log("[NEW]: ",o,o.fen());try{t.forEach(e=>o.move(e))}catch(e){console.log("[!!!] Error in initializing saved game: ",e)}q(o)}(async function(){let e=await g({gameID:t});e.ok&&e.data&&(u(1e3*e.data.w),w(1e3*e.data.b),"w"===Z.turn()?(v(!0),j(!1)):(v(!1),j(!0)))})()},[]);let M=e=>{console.log("MOVE: ",e),s?.emit("play-chess",JSON.stringify({move:e,id:t}))},G=()=>{s?.emit("end-game",JSON.stringify({id:t}))},I=()=>{console.log("Running init..."),s?.emit("start-game",JSON.stringify({id:t,userId:o,config:n}))},J=()=>{s?.emit("undo",JSON.stringify({id:t}))},z=()=>{let e=(0,m.io)("http://fall2324w3g9.int3306.freeddns.org",{autoConnect:!1,reconnection:!0});B(e),r(e)},B=e=>{console.log("Fetching saved game..."),e.emit("fetch-saved-game",JSON.stringify({id:t}))},[Z,q]=(0,c.useState)(x(n?.variant)),[$,D]=f({name:`${t}-is-playing`,defaultValue:!1}),[L,Q]=f({name:`${t}-moves`,defaultValue:[]}),[F,K]=(0,c.useState)(),[V,T]=(0,c.useReducer)(p,{check:{}}),U=e=>{console.log(e);let t=Z.move(e);if(t){let e;if(Q(Z.history({verbose:!0})),q(Z),Z.inCheck()){let t=Z.board().reduce((e,t,o)=>{let n=t.findIndex(e=>e&&"k"===e.type&&e.color===Z.turn());return n>=0?`${String.fromCharCode(n+97)}${8-o}`:e},"");e={[t]:{background:"radial-gradient(red, rgba(255,0,0,.8), transparent 70%)",borderRadius:"50%"}}}T({check:e}),"b"===Z.turn()?(j(!0),v(!1)):(j(!1),v(!0))}return t},A=()=>{Z.reset(),n?.variant===2&&Z.load("bnnqrkrb/pppppppp/8/8/8/8/PPPPPPPP/BNNQRKRB w KQkq - 0 1"),q(Z),G(),Q([]),F&&clearTimeout(F),D(!1),u((n?.timeMode??0)*6e4),w((n?.timeMode??0)*6e4),j(!1),v(!1),T({check:void 0})};return{game:Z,playing:$,moves:L,winner:y,customSquares:V,wPlayerTimeLeft:i,isWPlayerActive:h,bPlayerTimeLeft:S,isBPlayerActive:k,onPieceDrop:(e,t)=>{if(!$)return!1;let o=U({from:e,to:t,promotion:"q"});return null!==o&&(M(o.from+o.to+(o.promotion?o.promotion:"")),!0)},undoMove:()=>{J(),Z.undo(),Z.undo(),q(Z),Q(Z.history({verbose:!0})),T({check:void 0})},startGame:()=>{A(),I(),D(!0)},resetGame:A,forfeitGame:()=>{s?.emit("user-forfeit",JSON.stringify({id:t})),R("black")},prevMove:()=>{let e=Math.max(b-1,0),t=C[e];P(e),q(t),T({check:void 0})},nextMove:()=>{let e=Math.min(b+1,C.length-1),t=C[e];P(e),q(t),T({check:void 0})},socket:s}};var S=o(33367),w=o(71768);let k=({id:e,name:t})=>s.jsx("div",{className:"hover:opacity-60",children:s.jsx("div",{className:"w-[60px] h-[60px] border-2",children:s.jsx(w.Z,{name:t})})}),j=({botList:e,onSelectBot:t})=>(0,s.jsxs)("div",{children:[s.jsx("div",{className:"font-bold text-center pt-4",style:{fontSize:"20px"},children:"Ez Bot"}),s.jsx("div",{className:"w-auto flex row-auto pl-4 flex-wrap",children:e.map(e=>s.jsx("div",{className:"p-2",onClick:()=>{t(e)},children:s.jsx(k,{id:e.id,name:e.name})},e.id))})]});var y=o(70562);let N=({botList:e,onSelectBot:t,bot:o})=>s.jsx("div",{children:s.jsx("div",{className:"flex pt-4 pb-4",children:(0,s.jsxs)("ul",{className:"max-h-[550px] h-[550px] w-auto overflow-y-auto divide-y border rounded-lg",children:[s.jsx("div",{className:"w-[450px] text-center font-bold flex-wrap p-4",style:{fontSize:"27px"},children:"Play Chess Against a Computer"}),s.jsx("div",{className:"h-[300px]",children:s.jsx(y.Z,{id:o.id,name:o.name,inGame:!1})}),s.jsx("div",{children:s.jsx(j,{botList:e,onSelectBot:t})})]})})});var b=o(67474);let P=({timeLeft:e,going:t,turnIndicator:o})=>{let n=(0,c.useRef)(null),[r,a]=(0,c.useState)(Date.now()+e);return(0,c.useEffect)(()=>{t?n.current.start():n.current.pause()},[t]),(0,c.useEffect)(()=>{a(Date.now()+e)},[e]),s.jsx(b.ZP,{date:r,ref:n,autoStart:!1,intervalDelay:100,precision:1,renderer:({minutes:e,seconds:t,milliseconds:n})=>s.jsx("div",{className:"inline-block p-4 text-xl rounded-2xl font-mono "+(o?"bg-white":"bg-[#c8c8c8]"),children:(0,s.jsxs)("h1",{children:[(0,b.Bu)(e),":",(0,b.Bu)(t),".",n/100]})})})};var C=o(56495),O=o(90879),E=o(629),R=o(55100);let M=({id:e,type:t})=>{let o;let{userId:n,name:a}=(0,c.useContext)(R.UserContext),{game:d,playing:u,customSquares:m,winner:f,wPlayerTimeLeft:h,isWPlayerActive:g,bPlayerTimeLeft:p,isBPlayerActive:x,onPieceDrop:w,undoMove:k,startGame:j,resetGame:y,forfeitGame:b,prevMove:M,nextMove:G}=v({type:t,id:e,userId:n,gameConfig:o}),[I,J]=(0,c.useState)([]),[z,B]=(0,c.useState)({id:"0",name:"shark"}),[Z,q]=(0,c.useState)(!0);return(0,c.useEffect)(()=>{J([{id:"0",name:"shark"},{id:"1",name:"elephant"},{id:"2",name:"owl"},{id:"3",name:"monkey"},{id:"4",name:"penguin"},{id:"5",name:"cat"}])},[]),(0,s.jsxs)("div",{className:"flex p-4 mt-8",children:[s.jsx("div",{className:"flex justify-center w-2/3",children:(0,s.jsxs)("div",{className:"w-[450px]",children:[(0,s.jsxs)("div",{className:"",children:[o?.timeMode?s.jsx(P,{timeLeft:p,going:x&&u,turnIndicator:!1}):null,s.jsx(S.Z,{name:z?z.name:"none",link:z?"/home":"/profile/guest"})]}),!u&&s.jsx("div",{className:"absolute flex justify-center items-center w-[450px] h-[450px] z-10"}),s.jsx(r.r,{id:e,onPieceDrop:w,position:d.fen(),customBoardStyle:{borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.5)"},customSquareStyles:{...m.check}}),(0,s.jsxs)("div",{className:"",children:[s.jsx(S.Z,{name:a??"Guest",link:"/profile/guest"}),o?.timeMode?s.jsx(P,{timeLeft:h,going:g&&u,turnIndicator:!0}):null]})]})}),s.jsx("div",{className:"flex justify-center w-1/3",children:(0,s.jsxs)("div",{children:[u?(0,s.jsxs)(s.Fragment,{children:[s.jsx(i.Z,{moves:d.history({verbose:!0}).reverse(),bot:z||{id:"0",name:"shark"}}),"unknown"!==f?(0,s.jsxs)("div",{className:"flex justify-center",children:[s.jsx(O.Z,{style:{fontSize:"32px"},onClick:M}),s.jsx(E.Z,{style:{fontSize:"32px"},onClick:G})]}):null]}):s.jsx(N,{botList:I,onSelectBot:e=>{B(e)},bot:z||{id:"0",name:"shark"}}),s.jsx(l,{startGame:j,resetGame:y,forfeitGame:b,undoMove:k})]})}),"unknown"===f?null:s.jsx(C.Z,{winner:f,isOpen:Z,setOpen:q})]})}},67697:(e,t,o)=>{"use strict";o.d(t,{ZP:()=>i});var n=o(95153);let s=(0,n.createProxy)(String.raw`/home/nullchilly/code/git/web101/src/components/ChessGame/ChessGame.tsx`),{__esModule:r,$$typeof:a}=s,l=s.default,i=l}};