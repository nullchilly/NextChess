(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8260],{48260:function(e,n,t){Promise.resolve().then(t.bind(t,8819))},8819:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return E}});var o,r,a=t(57437),s=t(45303),l=t(80526),i=e=>{let{startGame:n,resetGame:t,undoMove:o,forfeitGame:r}=e;return(0,a.jsxs)("div",{className:"flex gap-4 mt-4",children:[(0,a.jsx)(l.z,{className:"w-full",onClick:()=>n(),children:"Start Game"}),(0,a.jsx)(l.z,{className:"w-full",onClick:()=>r(),children:"Forfeit"}),(0,a.jsx)(l.z,{className:"w-full",onClick:()=>o(),children:"Undo"})]})},c=t(69238),d=t(2265),u=t(64755),m=t(63388),f=t(80487);async function h(e){var n;let{gameID:t}=e,o=await fetch("".concat("http://fall2324w3g9.int3306.freeddns.org")+"/api/get-timer-info/".concat(t),{cache:"no-store"}).then(e=>e.json());return 200===o.status&&o.data?{ok:!0,data:o.data}:{ok:!1,error:null!==(n=o.error)&&void 0!==n?n:"Get player time left error"}}function p(e,n){return{...e,...n}}function g(e){return 1!==e&&e?new u.qQ("bnnqrkrb/pppppppp/8/8/8/8/PPPPPPPP/BNNQRKRB w KQkq - 0 1"):new u.qQ}(o=r||(r={})).Open="open",o.Connecting="connecting",o.Disconnected="disconnected";var v=e=>{var n,t;let{type:o,id:r,userId:a,gameConfig:s}=e,[l,i]=d.useState(null),[c,u]=d.useState("disconnected"),[v,x]=d.useState((null!==(n=null==s?void 0:s.timeMode)&&void 0!==n?n:0)*6e4),[k,w]=d.useState(!1),[y,S]=d.useState((null!==(t=null==s?void 0:s.timeMode)&&void 0!==t?t:0)*6e4),[j,b]=d.useState(!1),[N,C]=d.useState("unknown"),[P,O]=d.useState(0),[R,E]=d.useState([]),[J,M]=d.useState([]),z=d.useCallback(()=>{null==l||l.close(),i(null),u("disconnected")},[l,u]);function B(e){C(e),w(!1),b(!1);let n=_.history({verbose:!0}),t=[g(null==s?void 0:s.variant)];console.log("handle state: ",R);for(let e=0;e<n.length;e++){let o=g(null==s?void 0:s.variant);console.log("tempState: ".concat(e),o.fen());for(let t=0;t<=e;t++)try{o.move(n[t])}catch(e){console.log("[ERR]: ",e)}t.push(o)}null==l||l.emit("fetch-analysis",JSON.stringify({id:r})),E(t),O(t.length-1)}d.useEffect(()=>{l&&(l.connect(),l.on("connect",()=>{console.log("Connected",l.id)}),l.on("disconnect",()=>{z()}),l.on("play-chess",async e=>{console.log("Response",e);try{let n=JSON.parse(e);if(n.ok){if(n.move&&X({from:n.move.from,to:n.move.to,promotion:"q"}),3!==n.result.winner){let e=n.result.winner,t=n.result.reason;console.log("Reason: ",t),await new Promise(e=>setTimeout(e,1200)),B(0===e?"draw":1===e?"white":"black")}}else console.error("[!!!] Play chess socket error: ",n.error)}catch(e){console.error("[!!!] Play chess socket error: ",e)}}),l.on("start-game",e=>{console.log("Start game info: ",e);let n=JSON.parse(e);console.log("Given mess: ",n,n.ok),n.ok&&(w(!0),b(!1))}),l.on("end-game",e=>{console.log("clean up state: ",e)}),l.on("user-forfeit",e=>{console.log("user-forfeit socket message: ",e)}),l.on("fetch-saved-game",e=>{try{let t=JSON.parse(e);if(t.ok&&Number.isInteger(t.winner)){console.log("Res win: ",t.winner);let e="unknown";switch(t.winner){case 0:e="draw";break;case 1:e="white";case 2:e="black";default:console.log("Fetched winner: ",t.winner)}"unknown"!==e&&B(e),C(e)}else{var n;console.error("[!!!] Error when fetching saved data: ",null!==(n=t.error)&&void 0!==n?n:"")}}catch(e){console.error("[!!!] Can't fetch saved game data")}}),l.on("fetch-analysis",e=>{try{let n=JSON.parse(e);console.log("[RES]: ",n),Array.isArray(n.scores)&&(M(n.scores),z())}catch(e){console.error("[!!!] Can't fetch analysis",e)}}))},[z,u,l]),d.useEffect(()=>{D();let e=localStorage.getItem("@stockchess/useLocalStorage/".concat(r,"-moves"));if(e){let n=JSON.parse(e),t=g(null==s?void 0:s.variant);console.log("[NEW]: ",t,t.fen());try{n.forEach(e=>t.move(e))}catch(e){console.log("[!!!] Error in initializing saved game: ",e)}L(t)}(async function(){let e=await h({gameID:r});e.ok&&e.data&&(x(1e3*e.data.w),S(1e3*e.data.b),"w"===_.turn()?(w(!0),b(!1)):(w(!1),b(!0)))})()},[]);let G=e=>{console.log("MOVE: ",e),null==l||l.emit("play-chess",JSON.stringify({move:e,id:r}))},q=()=>{null==l||l.emit("end-game",JSON.stringify({id:r}))},I=()=>{console.log("Running init..."),null==l||l.emit("start-game",JSON.stringify({id:r,userId:a,config:s}))},Z=()=>{null==l||l.emit("undo",JSON.stringify({id:r}))},D=()=>{let e=(0,m.io)("".concat("http://fall2324w3g9.int3306.freeddns.org"),{autoConnect:!1,reconnection:!0});Q(e),i(e)},Q=e=>{console.log("Fetching saved game..."),e.emit("fetch-saved-game",JSON.stringify({id:r}))},[_,L]=(0,d.useState)(g(null==s?void 0:s.variant)),[F,K]=(0,f._)({name:"".concat(r,"-is-playing"),defaultValue:!1}),[A,V]=(0,f._)({name:"".concat(r,"-moves"),defaultValue:[]}),[T,U]=(0,d.useState)(),[W,H]=(0,d.useReducer)(p,{check:{}}),X=e=>{console.log(e);let n=_.move(e);if(n){let e;if(V(_.history({verbose:!0})),L(_),_.inCheck()){let n=_.board().reduce((e,n,t)=>{let o=n.findIndex(e=>e&&"k"===e.type&&e.color===_.turn());return o>=0?"".concat(String.fromCharCode(o+97)).concat(8-t):e},"");e={[n]:{background:"radial-gradient(red, rgba(255,0,0,.8), transparent 70%)",borderRadius:"50%"}}}H({check:e}),"b"===_.turn()?(b(!0),w(!1)):(b(!1),w(!0))}return n},Y=()=>{var e,n;_.reset(),(null==s?void 0:s.variant)===2&&_.load("bnnqrkrb/pppppppp/8/8/8/8/PPPPPPPP/BNNQRKRB w KQkq - 0 1"),L(_),q(),V([]),T&&clearTimeout(T),K(!1),x((null!==(e=null==s?void 0:s.timeMode)&&void 0!==e?e:0)*6e4),S((null!==(n=null==s?void 0:s.timeMode)&&void 0!==n?n:0)*6e4),b(!1),w(!1),H({check:void 0})};return{game:_,playing:F,moves:A,winner:N,customSquares:W,wPlayerTimeLeft:v,isWPlayerActive:k,bPlayerTimeLeft:y,isBPlayerActive:j,onPieceDrop:(e,n)=>{if(!F)return!1;let t=X({from:e,to:n,promotion:"q"});return null!==t&&(G(t.from+t.to+(t.promotion?t.promotion:"")),!0)},undoMove:()=>{Z(),_.undo(),_.undo(),L(_),V(_.history({verbose:!0})),H({check:void 0})},startGame:()=>{Y(),I(),K(!0)},resetGame:Y,forfeitGame:()=>{null==l||l.emit("user-forfeit",JSON.stringify({id:r})),B("black")},prevMove:()=>{let e;let n=Math.max(P-1,0),t=R[n];if(O(n),L(t),t.inCheck()){let n=t.board().reduce((e,n,o)=>{let r=n.findIndex(e=>e&&"k"===e.type&&e.color===t.turn());return r>=0?"".concat(String.fromCharCode(r+97)).concat(8-o):e},"");e={[n]:{background:"radial-gradient(red, rgba(255,0,0,.8), transparent 70%)",borderRadius:"50%"}}}H({check:e})},nextMove:()=>{let e;let n=Math.min(P+1,R.length-1),t=R[n];if(O(n),L(t),t.inCheck()){let n=t.board().reduce((e,n,o)=>{let r=n.findIndex(e=>e&&"k"===e.type&&e.color===t.turn());return r>=0?"".concat(String.fromCharCode(r+97)).concat(8-o):e},"");e={[n]:{background:"radial-gradient(red, rgba(255,0,0,.8), transparent 70%)",borderRadius:"50%"}}}H({check:e})},analysisMoves:J,socket:l}},x=t(12506),k=t(30118);let w=e=>{let{id:n,name:t}=e;return(0,a.jsx)("div",{className:"hover:opacity-60",children:(0,a.jsx)("div",{className:"w-[60px] h-[60px] border-2",children:(0,a.jsx)(k.Z,{name:t})})})};var y=e=>{let{botList:n,onSelectBot:t}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-center pt-4",style:{fontSize:"20px"},children:"Ez Bot"}),(0,a.jsx)("div",{className:"w-auto flex row-auto pl-4 flex-wrap",children:n.map(e=>(0,a.jsx)("div",{className:"p-2",onClick:()=>{t(e)},children:(0,a.jsx)(w,{id:e.id,name:e.name})},e.id))})]})},S=t(98998),j=e=>{let{botList:n,onSelectBot:t,bot:o}=e;return(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"flex pt-4 pb-4",children:(0,a.jsxs)("ul",{className:"max-h-[550px] h-[550px] w-auto overflow-y-auto divide-y border rounded-lg",children:[(0,a.jsx)("div",{className:"w-[450px] text-center font-bold flex-wrap p-4",style:{fontSize:"27px"},children:"Play Chess Against a Computer"}),(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(S.Z,{id:o.id,name:o.name,inGame:!1})}),(0,a.jsx)("div",{children:(0,a.jsx)(y,{botList:n,onSelectBot:t})})]})})})},b=t(96215),N=e=>{let{timeLeft:n,going:t,turnIndicator:o}=e,r=(0,d.useRef)(null),[s,l]=(0,d.useState)(Date.now()+n);return(0,d.useEffect)(()=>{t?r.current.start():r.current.pause()},[t]),(0,d.useEffect)(()=>{l(Date.now()+n)},[n]),(0,a.jsx)(b.ZP,{date:s,ref:r,autoStart:!1,intervalDelay:100,precision:1,renderer:e=>{let{minutes:n,seconds:t,milliseconds:r}=e;return(0,a.jsx)("div",{className:"inline-block p-4 text-xl rounded-2xl font-mono "+(o?"bg-white":"bg-[#c8c8c8]"),children:(0,a.jsxs)("h1",{children:[(0,b.Bu)(n),":",(0,b.Bu)(t),".",r/100]})})}})},C=t(71198),P=t(46848),O=t(17369),R=t(91658),E=e=>{let n,{id:t,type:o}=e,{userId:r,name:l}=(0,d.useContext)(R.UserContext);try{var u;n=JSON.parse(null!==(u=localStorage.getItem("config-".concat(t)))&&void 0!==u?u:"")}catch(e){console.error("Can't parse game config: ",e,!1)}let{game:m,playing:f,customSquares:h,winner:p,wPlayerTimeLeft:g,isWPlayerActive:k,bPlayerTimeLeft:w,isBPlayerActive:y,onPieceDrop:S,undoMove:b,startGame:E,resetGame:J,forfeitGame:M,prevMove:z,nextMove:B,analysisMoves:G}=v({type:o,id:t,userId:r,gameConfig:n}),[q,I]=(0,d.useState)([]),[Z,D]=(0,d.useState)({id:"0",name:"shark"}),[Q,_]=(0,d.useState)(!0);return(0,d.useEffect)(()=>{I([{id:"0",name:"shark"},{id:"1",name:"elephant"},{id:"2",name:"owl"},{id:"3",name:"monkey"},{id:"4",name:"penguin"},{id:"5",name:"cat"}])},[]),(0,a.jsxs)("div",{className:"flex p-4 mt-8",children:[(0,a.jsx)("div",{className:"flex justify-center w-2/3",children:(0,a.jsxs)("div",{className:"w-[450px]",children:[(0,a.jsxs)("div",{className:"",children:[(null==n?void 0:n.timeMode)?(0,a.jsx)(N,{timeLeft:w,going:y&&f,turnIndicator:!1}):null,(0,a.jsx)(x.Z,{name:Z?Z.name:"none",link:Z?"/home":"/profile/guest"})]}),!f&&(0,a.jsx)("div",{className:"absolute flex justify-center items-center w-[450px] h-[450px] z-10"}),(0,a.jsx)(s.r,{id:t,onPieceDrop:S,position:m.fen(),customBoardStyle:{borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.5)"},customSquareStyles:{...h.check}}),(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)(x.Z,{name:null!=l?l:"Guest",link:"/profile/guest"}),(null==n?void 0:n.timeMode)?(0,a.jsx)(N,{timeLeft:g,going:k&&f,turnIndicator:!0}):null]})]})}),(0,a.jsx)("div",{className:"flex justify-center w-1/3",children:(0,a.jsxs)("div",{children:[f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{moves:m.history({verbose:!0}).reverse(),bot:Z||{id:"0",name:"shark"},scores:G}),"unknown"!==p?(0,a.jsxs)("div",{className:"flex justify-center",children:[(0,a.jsx)(P.Z,{style:{fontSize:"32px"},onClick:z}),(0,a.jsx)(O.Z,{style:{fontSize:"32px"},onClick:B})]}):null]}):(0,a.jsx)(j,{botList:q,onSelectBot:e=>{D(e)},bot:Z||{id:"0",name:"shark"}}),(0,a.jsx)(i,{startGame:E,resetGame:J,forfeitGame:M,undoMove:b})]})}),"unknown"===p?null:(0,a.jsx)(C.Z,{winner:p,isOpen:Q,setOpen:_})]})}}}]);