(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8260],{48260:function(e,t,n){Promise.resolve().then(n.bind(n,97761))},97761:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return J}});var o,l,a=n(57437),r=n(45303),s=n(80526),i=e=>{let{startGame:t,resetGame:n,undoMove:o,forfeitGame:l}=e;return(0,a.jsxs)("div",{className:"flex gap-4 mt-4",children:[(0,a.jsx)(s.z,{className:"w-full",onClick:()=>t(),children:"Start Game"}),(0,a.jsx)(s.z,{className:"w-full",onClick:()=>l(),children:"Forfeit"}),(0,a.jsx)(s.z,{className:"w-full",onClick:()=>o(),children:"Undo"})]})},c=n(69238),d=n(2265),u=n(64755),m=n(63388);function f(e){let{defaultValue:t,name:n}=e,[o,l]=(0,d.useState)(void 0),a="@stockchess/useLocalStorage/".concat(n);return(0,d.useEffect)(function(){if(h()){let e=localStorage.getItem(a);e?l(JSON.parse(e)):l(t)}},[]),(0,d.useEffect)(function(){h()&&void 0!==o&&localStorage.setItem(a,JSON.stringify(o))},[o]),[null!=o?o:t,l,function(){h()&&localStorage.removeItem(a)}]}function h(){try{if(!window.localStorage||null===localStorage||"undefined"==typeof localStorage||(localStorage.setItem("localStorage:test","value"),"value"!==localStorage.getItem("localStorage:test")))return!1;return localStorage.removeItem("localStorage:test"),!0}catch(e){return!1}}async function v(e){var t;let{gameID:n}=e,o=await fetch("".concat("http://fall2324w3g9.int3306.freeddns.org")+"/api/get-timer-info/".concat(n),{cache:"no-store"}).then(e=>e.json());return 200===o.status&&o.data?{ok:!0,data:o.data}:{ok:!1,error:null!==(t=o.error)&&void 0!==t?t:"Get player time left error"}}function g(e,t){return{...e,...t}}function p(e){return 1!==e&&e?new u.qQ("bnnqrkrb/pppppppp/8/8/8/8/PPPPPPPP/BNNQRKRB w KQkq - 0 1"):new u.qQ}(o=l||(l={})).Open="open",o.Connecting="connecting",o.Disconnected="disconnected";var x=e=>{var t,n;let{type:o,id:l,userId:a,gameConfig:r}=e,[s,i]=d.useState(null),[c,u]=d.useState("disconnected"),[h,x]=d.useState((null!==(t=null==r?void 0:r.timeMode)&&void 0!==t?t:0)*6e4),[S,k]=d.useState(!1),[w,j]=d.useState((null!==(n=null==r?void 0:r.timeMode)&&void 0!==n?n:0)*6e4),[y,N]=d.useState(!1),[b,P]=d.useState("unknown"),[C,O]=d.useState(0),[E,I]=d.useState([]),J=d.useCallback(()=>{null==s||s.close(),i(null),u("disconnected")},[s,u]);function M(e){P(e),k(!1),N(!1);let t=D.history({verbose:!0}),n=[p(null==r?void 0:r.variant)];console.log("handle state: ",E);for(let e=0;e<t.length;e++){let o=p(null==r?void 0:r.variant);console.log("tempSate: ".concat(e),o.fen());for(let n=0;n<=e;n++)try{o.move(t[n])}catch(e){console.log("[ERR]: ",e)}n.push(o)}I(n),O(n.length-1)}d.useEffect(()=>{s&&(s.connect(),s.on("connect",()=>{console.log("Connected",s.id)}),s.on("disconnect",()=>{J()}),s.on("play-chess",async e=>{console.log("Response",e);try{let t=JSON.parse(e);if(t.ok){if(t.move&&W({from:t.move.from,to:t.move.to,promotion:"q"}),3!==t.result.winner){let e=t.result.winner,n=t.result.reason;console.log("Reason: ",n),await new Promise(e=>setTimeout(e,1200)),M(0===e?"draw":1===e?"white":"black")}}else console.error("[!!!] Play chess socket error: ",t.error)}catch(e){console.error("[!!!] Play chess socket error: ",e)}}),s.on("start-game",e=>{console.log("Start game info: ",e);let t=JSON.parse(e);console.log("Given mess: ",t,t.ok),t.ok&&(k(!0),N(!1))}),s.on("end-game",e=>{console.log("clean up state: ",e)}),s.on("user-forfeit",e=>{console.log("user-forfeit socket message: ",e)}),s.on("fetch-saved-game",e=>{try{let n=JSON.parse(e);if(n.ok&&Number.isInteger(n.winner)){let e="unknown";switch(n.winner){case 0:e="draw";break;case 1:e="white";case 2:e="black";default:console.log("Fetched winner: ",n.winner)}"unknown"!==e&&M(e),P(e)}else{var t;console.error("[!!!] Error when fetching saved data: ",null!==(t=n.error)&&void 0!==t?t:"")}}catch(e){console.error("[!!!] Can't fetch saved game data")}}))},[J,u,s]),d.useEffect(()=>{q();let e=localStorage.getItem("@stockchess/useLocalStorage/".concat(l,"-moves"));if(e){let t=JSON.parse(e),n=p(null==r?void 0:r.variant);console.log("[NEW]: ",n,n.fen());try{t.forEach(e=>n.move(e))}catch(e){console.log("[!!!] Error in initializing saved game: ",e)}L(n)}(async function(){let e=await v({gameID:l});e.ok&&e.data&&(x(1e3*e.data.w),j(1e3*e.data.b),"w"===D.turn()?(k(!0),N(!1)):(k(!1),N(!0)))})()},[]);let R=e=>{console.log("MOVE: ",e),null==s||s.emit("play-chess",JSON.stringify({move:e,id:l}))},z=()=>{null==s||s.emit("end-game",JSON.stringify({id:l}))},B=()=>{console.log("Running init..."),null==s||s.emit("start-game",JSON.stringify({id:l,userId:a,config:r}))},G=()=>{null==s||s.emit("undo",JSON.stringify({id:l}))},q=()=>{let e=(0,m.io)("".concat("http://fall2324w3g9.int3306.freeddns.org"),{autoConnect:!1,reconnection:!0});Z(e),i(e)},Z=e=>{e.emit("fetch-saved-game",JSON.stringify({id:l}))},[D,L]=(0,d.useState)(p(null==r?void 0:r.variant)),[Q,K]=f({name:"".concat(l,"-is-playing"),defaultValue:!1}),[_,F]=f({name:"".concat(l,"-moves"),defaultValue:[]}),[V,T]=(0,d.useState)(),[U,A]=(0,d.useReducer)(g,{check:{}}),W=e=>{console.log(e);let t=D.move(e);if(t){let e;if(F(D.history({verbose:!0})),L(D),D.inCheck()){let t=D.board().reduce((e,t,n)=>{let o=t.findIndex(e=>e&&"k"===e.type&&e.color===D.turn());return o>=0?"".concat(String.fromCharCode(o+97)).concat(8-n):e},"");e={[t]:{background:"radial-gradient(red, rgba(255,0,0,.8), transparent 70%)",borderRadius:"50%"}}}A({check:e}),"b"===D.turn()?(N(!0),k(!1)):(N(!1),k(!0))}return t},H=()=>{var e,t;D.reset(),(null==r?void 0:r.variant)===2&&D.load("bnnqrkrb/pppppppp/8/8/8/8/PPPPPPPP/BNNQRKRB w KQkq - 0 1"),L(D),z(),F([]),V&&clearTimeout(V),K(!1),x((null!==(e=null==r?void 0:r.timeMode)&&void 0!==e?e:0)*6e4),j((null!==(t=null==r?void 0:r.timeMode)&&void 0!==t?t:0)*6e4),N(!1),k(!1),A({check:void 0})};return{game:D,playing:Q,moves:_,winner:b,customSquares:U,wPlayerTimeLeft:h,isWPlayerActive:S,bPlayerTimeLeft:w,isBPlayerActive:y,onPieceDrop:(e,t)=>{if(!Q)return!1;let n=W({from:e,to:t,promotion:"q"});return null!==n&&(R(n.from+n.to+(n.promotion?n.promotion:"")),!0)},undoMove:()=>{G(),D.undo(),D.undo(),L(D),F(D.history({verbose:!0})),A({check:void 0})},startGame:()=>{H(),B(),K(!0)},resetGame:H,forfeitGame:()=>{null==s||s.emit("user-forfeit",JSON.stringify({id:l})),M("black")},prevMove:()=>{let e=Math.max(C-1,0),t=E[e];O(e),L(t),A({check:void 0})},nextMove:()=>{let e=Math.min(C+1,E.length-1),t=E[e];O(e),L(t),A({check:void 0})},socket:s}},S=n(12506),k=n(30118);let w=e=>{let{id:t,name:n}=e;return(0,a.jsx)("div",{className:"hover:opacity-60",children:(0,a.jsx)("div",{className:"w-[60px] h-[60px] border-2",children:(0,a.jsx)(k.Z,{name:n})})})};var j=e=>{let{botList:t,onSelectBot:n}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-bold text-center pt-4",style:{fontSize:"20px"},children:"Ez Bot"}),(0,a.jsx)("div",{className:"w-auto flex row-auto pl-4 flex-wrap",children:t.map(e=>(0,a.jsx)("div",{className:"p-2",onClick:()=>{n(e)},children:(0,a.jsx)(w,{id:e.id,name:e.name})},e.id))})]})},y=n(98998),N=e=>{let{botList:t,onSelectBot:n,bot:o}=e;return(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"flex pt-4 pb-4",children:(0,a.jsxs)("ul",{className:"max-h-[550px] h-[550px] w-auto overflow-y-auto divide-y border rounded-lg",children:[(0,a.jsx)("div",{className:"w-[450px] text-center font-bold flex-wrap p-4",style:{fontSize:"27px"},children:"Play Chess Against a Computer"}),(0,a.jsx)("div",{className:"h-[300px]",children:(0,a.jsx)(y.Z,{id:o.id,name:o.name,inGame:!1})}),(0,a.jsx)("div",{children:(0,a.jsx)(j,{botList:t,onSelectBot:n})})]})})})},b=n(96215),P=e=>{let{timeLeft:t,going:n,turnIndicator:o}=e,l=(0,d.useRef)(null),[r,s]=(0,d.useState)(Date.now()+t);return(0,d.useEffect)(()=>{n?l.current.start():l.current.pause()},[n]),(0,d.useEffect)(()=>{s(Date.now()+t)},[t]),(0,a.jsx)(b.ZP,{date:r,ref:l,autoStart:!1,intervalDelay:100,precision:1,renderer:e=>{let{minutes:t,seconds:n,milliseconds:l}=e;return(0,a.jsx)("div",{className:"inline-block p-4 text-xl rounded-2xl font-mono "+(o?"bg-white":"bg-[#c8c8c8]"),children:(0,a.jsxs)("h1",{children:[(0,b.Bu)(t),":",(0,b.Bu)(n),".",l/100]})})}})},C=n(71198),O=n(46848),E=n(17369),I=n(91658),J=e=>{let t,{id:n,type:o}=e,{userId:l,name:s}=(0,d.useContext)(I.UserContext);try{var u;t=JSON.parse(null!==(u=localStorage.getItem("config-".concat(n)))&&void 0!==u?u:"")}catch(e){console.error("Can't parse game config: ",e,!1)}let{game:m,playing:f,customSquares:h,winner:v,wPlayerTimeLeft:g,isWPlayerActive:p,bPlayerTimeLeft:k,isBPlayerActive:w,onPieceDrop:j,undoMove:y,startGame:b,resetGame:J,forfeitGame:M,prevMove:R,nextMove:z}=x({type:o,id:n,userId:l,gameConfig:t}),[B,G]=(0,d.useState)([]),[q,Z]=(0,d.useState)({id:"0",name:"shark"}),[D,L]=(0,d.useState)(!0);return(0,d.useEffect)(()=>{G([{id:"0",name:"shark"},{id:"1",name:"elephant"},{id:"2",name:"owl"},{id:"3",name:"monkey"},{id:"4",name:"penguin"},{id:"5",name:"cat"}])},[]),(0,a.jsxs)("div",{className:"flex p-4 mt-8",children:[(0,a.jsx)("div",{className:"flex justify-center w-2/3",children:(0,a.jsxs)("div",{className:"w-[450px]",children:[(0,a.jsxs)("div",{className:"",children:[(null==t?void 0:t.timeMode)?(0,a.jsx)(P,{timeLeft:k,going:w&&f,turnIndicator:!1}):null,(0,a.jsx)(S.Z,{name:q?q.name:"none",link:q?"/home":"/profile/guest"})]}),!f&&(0,a.jsx)("div",{className:"absolute flex justify-center items-center w-[450px] h-[450px] z-10"}),(0,a.jsx)(r.r,{id:n,onPieceDrop:j,position:m.fen(),customBoardStyle:{borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.5)"},customSquareStyles:{...h.check}}),(0,a.jsxs)("div",{className:"",children:[(0,a.jsx)(S.Z,{name:null!=s?s:"Guest",link:"/profile/guest"}),(null==t?void 0:t.timeMode)?(0,a.jsx)(P,{timeLeft:g,going:p&&f,turnIndicator:!0}):null]})]})}),(0,a.jsx)("div",{className:"flex justify-center w-1/3",children:(0,a.jsxs)("div",{children:[f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.Z,{moves:m.history({verbose:!0}).reverse(),bot:q||{id:"0",name:"shark"}}),"unknown"!==v?(0,a.jsxs)("div",{className:"flex justify-center",children:[(0,a.jsx)(O.Z,{style:{fontSize:"32px"},onClick:R}),(0,a.jsx)(E.Z,{style:{fontSize:"32px"},onClick:z})]}):null]}):(0,a.jsx)(N,{botList:B,onSelectBot:e=>{Z(e)},bot:q||{id:"0",name:"shark"}}),(0,a.jsx)(i,{startGame:b,resetGame:J,forfeitGame:M,undoMove:y})]})}),"unknown"===v?null:(0,a.jsx)(C.Z,{winner:v,isOpen:D,setOpen:L})]})}}}]);