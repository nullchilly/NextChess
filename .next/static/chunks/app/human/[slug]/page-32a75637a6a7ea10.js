(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[217],{36106:function(e,n,t){Promise.resolve().then(t.bind(t,67237))},67237:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return k}});var o=t(57437),r=t(91658),l=t(64755),s=t(2265),c=t(63388),a=t(80487);function i(e,n){return{...e,...n}}var u=e=>{let{id:n,userId:t,name:o}=e,[r,u]=(0,s.useState)(null),[d,f]=(0,s.useState)(0),[h,m]=(0,s.useState)("w"),[p,g]=(0,s.useState)(!1),[x,k]=(0,s.useState)(new l.qQ),[b,w]=(0,s.useState)("start"),[y,j]=(0,s.useState)(""),[S,v]=(0,s.useReducer)(i,{check:{}}),[C,N]=(0,s.useState)("unknown"),[E,O]=(0,s.useState)(0),[R,M]=(0,s.useState)([]);function P(){return new l.qQ}function _(e){N(e);let n=x.history({verbose:!0});console.log(n);let t=[P()];console.log("handle state: ",R);for(let e=0;e<n.length;e++){let o=P();for(let t=0;t<=e;t++)try{o.move(n[t])}catch(e){console.log("[ERR]: ",e)}console.log("TEMPSTATE",o.fen()),t.push(o)}M(t),O(t.length-1),J()}let J=(0,s.useCallback)(()=>{null==r||r.close(),u(null)},[r]);(0,s.useEffect)(()=>{r&&(r.connect(),r.on("connect",()=>{console.log("Connected",r.id)}),r.on("human-user-forfeit",async e=>{console.log(e),_("white")}),r.on("human-new-player-join",async e=>{console.log("JOINED:",e);try{let n=JSON.parse(e);if(n.ok){let e=n.numberPlayer,t=n.config.color,o=n.config.opponentName;f(e),g(2===e),("w"===t||"b"===t)&&m(t),"string"==typeof o&&j(o)}else"boolean"==typeof n.playable&&g(n.playable),("w"===n.color||"b"===n.color)&&m(n.color)}catch(e){console.error("[!!!] Error when new user join: ",e)}}),r.on("human-play-chess",async e=>{console.log("MOVE socket: ",e);try{let n=JSON.parse(e);if(n.ok){if(n.result){let e=n.result.winner,t=n.result.reason;console.log("Reason: ",t),await new Promise(e=>setTimeout(e,1200)),_(0===e?"draw":1===e?"white":"black")}console.log("Opponent move: ",n.move),T(n.move)}else console.error("[!!!] response not ok: ",n.error)}catch(e){console.error("[!!!] Error when new user join: ",e)}}))},[J,r]),(0,s.useEffect)(()=>{r||!t||p||Z()},[t]);let Z=()=>{let e=(0,c.io)("".concat("http://fall2324w3g9.int3306.freeddns.org"),{autoConnect:!1,reconnection:!0});!p&&t&&q(null!=t?t:1,e),u(e)},q=(e,t)=>{t.emit("human-new-player-join",JSON.stringify({id:n,userId:e,name:o}))},[D,I]=(0,a._)({name:"".concat(n,"-moves"),defaultValue:[]}),T=e=>{console.log(e);let n=x.move(e);if(n){let e;if(w(x.fen()),k(x),console.log(x.inCheck()),x.inCheck()){let n=x.board().reduce((e,n,t)=>{let o=n.findIndex(e=>((null==e?void 0:e.type)=="k"&&console.log(e),e&&"k"===e.type&&e.color===x.turn()));return o>=0?"".concat(String.fromCharCode(o+97)).concat(8-t):e},"");e={[n]:{background:"radial-gradient(red, rgba(255,0,0,.8), transparent 70%)",borderRadius:"50%"}}}console.log(e),v({check:e})}return n},z=e=>{console.log("MOVE: ",e),null==r||r.emit("human-play-chess",JSON.stringify({move:e,id:n,turn:h}))};return{socket:r,winner:C,forfeitGame:()=>{null==r||r.emit("human-user-forfeit",JSON.stringify({id:n,winner:y})),_("black")},customSquares:S,playable:p,pieceColor:h,onPieceDrop:(e,n)=>{if(!p)return!1;let t=T({from:e,to:n,promotion:"q"});return null!==t&&(z(t.from+t.to+(t.promotion?t.promotion:"")),!0)},game:x,gameFen:b,setGameFen:w,opponentName:y,prevMove:()=>{let e;let n=Math.max(E-1,0),t=R[n];if(w(t.fen()),console.log("ALL: ",E,R),O(n),k(t),t.inCheck()){let n=t.board().reduce((e,n,o)=>{let r=n.findIndex(e=>e&&"k"===e.type&&e.color===t.turn());return r>=0?"".concat(String.fromCharCode(r+97)).concat(8-o):e},"");e={[n]:{background:"radial-gradient(red, rgba(255,0,0,.8), transparent 70%)",borderRadius:"50%"}}}v({check:e})},nextMove:()=>{let e;let n=Math.min(E+1,R.length-1),t=R[n];if(w(t.fen()),O(n),k(t),t.inCheck()){let n=t.board().reduce((e,n,o)=>{let r=n.findIndex(e=>e&&"k"===e.type&&e.color===t.turn());return r>=0?"".concat(String.fromCharCode(r+97)).concat(8-o):e},"");e={[n]:{background:"radial-gradient(red, rgba(255,0,0,.8), transparent 70%)",borderRadius:"50%"}}}v({check:e})}}},d=t(45303),f=t(12506),h=t(69238),m=t(71198),p=t(80526),g=t(46848),x=t(17369),k=e=>{let{id:n}=e,{userId:t,name:l}=(0,s.useContext)(r.UserContext),[c,a]=(0,s.useState)(""),[i,k]=(0,s.useState)(!0);(0,s.useEffect)(()=>{try{a(window.location.href)}catch(e){console.error("Can't parse game config: ",e,!1)}},[]);let{socket:b,winner:w,forfeitGame:y,customSquares:j,playable:S,pieceColor:v,onPieceDrop:C,game:N,gameFen:E,setGameFen:O,opponentName:R,prevMove:M,nextMove:P}=u({id:n,userId:t,name:l});return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:"flex p-4 mt-8",children:[(0,o.jsx)("div",{className:"flex justify-center w-2/3",children:(0,o.jsxs)("div",{className:"w-[500px]",children:[(0,o.jsxs)("span",{className:"text-l ".concat("b"===N.turn()?"text-black":"text-white"," font-mono flex items-center pb-3 pt-0.5"),children:[" ","w"===N.turn()?"White turn":"Black turn"," "]}),(0,o.jsx)("div",{children:(0,o.jsx)(f.Z,{name:R,link:""})}),(0,o.jsx)(d.r,{id:n,onPieceDrop:C,boardOrientation:"b"===v?"black":"white",isDraggablePiece:function(e){return e.piece.startsWith(v)},position:E,customBoardStyle:{borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.5)"},customSquareStyles:{...j.check}}),(0,o.jsx)("div",{children:(0,o.jsx)(f.Z,{name:null!=l?l:"Guest",link:""})})]})}),(0,o.jsx)("div",{className:"flex justify-center w-1/3",children:(0,o.jsx)("div",{children:S?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(h.Z,{moves:N.history({verbose:!0}).reverse(),bot:{id:"0",name:"shark"}}),"unknown"!==w?(0,o.jsxs)("div",{className:"flex justify-center",children:[(0,o.jsx)(g.Z,{style:{fontSize:"32px"},onClick:M}),(0,o.jsx)(x.Z,{style:{fontSize:"32px"},onClick:P})]}):null,(0,o.jsx)("div",{className:"flex gap-4 mt-4",children:(0,o.jsx)(p.z,{className:"w-full",onClick:()=>y(),children:"Forfeit"})})]}):null})}),"unknown"===w?null:(0,o.jsx)(m.Z,{winner:w,isOpen:i,setOpen:k})]})})}}},function(e){e.O(0,[6227,1094,5279,7197,8110,8623,4195,8813,3071,2480,3570,1328,298,3388,8002,4836,7896,8187,1409,8998,1508,2971,2472,1744],function(){return e(e.s=36106)}),_N_E=e.O()}]);