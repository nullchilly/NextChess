(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[217],{36106:function(e,n,o){Promise.resolve().then(o.bind(o,67237))},67237:function(e,n,o){"use strict";o.r(n),o.d(n,{default:function(){return p}});var t=o(57437),r=o(91658),s=o(64755),l=o(2265),c=o(63388);function i(e,n){return{...e,...n}}var a=e=>{let{id:n,userId:o,name:t}=e,[r,a]=(0,l.useState)(null),[u,f]=(0,l.useState)(0),[d,h]=(0,l.useState)("w"),[m,p]=(0,l.useState)(!1),[w,x]=(0,l.useState)(new s.qQ),[g,b]=(0,l.useState)("start"),[k,y]=(0,l.useState)(""),[j,v]=(0,l.useReducer)(i,{check:{}}),[S,N]=(0,l.useState)("unknown"),O=(0,l.useCallback)(()=>{null==r||r.close(),a(null)},[r]);(0,l.useEffect)(()=>{r&&(r.connect(),r.on("connect",()=>{console.log("Connected",r.id)}),r.on("human-user-forfeit",async e=>{console.log(e),N("white")}),r.on("human-new-player-join",async e=>{console.log("JOINED:",e);try{let n=JSON.parse(e);if(n.ok){let e=n.numberPlayer,o=n.config.color,t=n.config.opponentName;f(e),p(2===e),("w"===o||"b"===o)&&h(o),"string"==typeof t&&y(t)}else"boolean"==typeof n.playable&&p(n.playable),("w"===n.color||"b"===n.color)&&h(n.color)}catch(e){console.error("[!!!] Error when new user join: ",e)}}),r.on("human-play-chess",async e=>{console.log("MOVE socket: ",e);try{let n=JSON.parse(e);if(n.ok){if(n.result){let e=n.result.winner,o=n.result.reason;console.log("Reason: ",o),await new Promise(e=>setTimeout(e,1200)),N(0===e?"draw":1===e?"white":"black")}console.log("Opponent move: ",n.move),J(n.move)}else console.error("[!!!] response not ok: ",n.error)}catch(e){console.error("[!!!] Error when new user join: ",e)}}))},[O,r]),(0,l.useEffect)(()=>{r||!o||m||C()},[o]);let C=()=>{let e=(0,c.io)("".concat("http://fall2324w3g9.int3306.freeddns.org"),{autoConnect:!1,reconnection:!0});!m&&o&&E(null!=o?o:1,e),a(e)},E=(e,o)=>{o.emit("human-new-player-join",JSON.stringify({id:n,userId:e,name:t}))},J=e=>{console.log(e);let n=w.move(e);if(n){let e;if(b(w.fen()),x(w),console.log(w.inCheck()),w.inCheck()){let n=w.board().reduce((e,n,o)=>{let t=n.findIndex(e=>((null==e?void 0:e.type)=="k"&&console.log(e),e&&"k"===e.type&&e.color===w.turn()));return t>=0?"".concat(String.fromCharCode(t+97)).concat(8-o):e},"");e={[n]:{background:"radial-gradient(red, rgba(255,0,0,.8), transparent 70%)",borderRadius:"50%"}}}console.log(e),v({check:e})}return n},P=e=>{console.log("MOVE: ",e),null==r||r.emit("human-play-chess",JSON.stringify({move:e,id:n,turn:d}))};return{socket:r,winner:S,forfeitGame:()=>{null==r||r.emit("human-user-forfeit",JSON.stringify({id:n,winner:k})),N("black")},customSquares:j,playable:m,pieceColor:d,onPieceDrop:(e,n)=>{if(!m)return!1;let o=J({from:e,to:n,promotion:"q"});return null!==o&&(P(o.from+o.to+(o.promotion?o.promotion:"")),!0)},game:w,gameFen:g,setGameFen:b,opponentName:k}},u=o(45303),f=o(12506),d=o(69238),h=o(71198),m=o(80526),p=e=>{let{id:n}=e,{userId:o,name:s}=(0,l.useContext)(r.UserContext),[c,i]=(0,l.useState)(""),[p,w]=(0,l.useState)(!0);(0,l.useEffect)(()=>{try{i(window.location.href)}catch(e){console.error("Can't parse game config: ",e,!1)}},[]);let{socket:x,winner:g,forfeitGame:b,customSquares:k,playable:y,pieceColor:j,onPieceDrop:v,game:S,gameFen:N,setGameFen:O,opponentName:C}=a({id:n,userId:o,name:s});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"p-4",children:y?"May the best man win":"To invite someone to play, give this URL: ".concat(c)}),(0,t.jsxs)("div",{className:"flex p-4 mt-8",children:[(0,t.jsx)("div",{className:"flex justify-center w-2/3",children:(0,t.jsxs)("div",{className:"w-[500px]",children:[(0,t.jsxs)("span",{className:"text-l ".concat("b"===S.turn()?"text-black":"text-white"," font-mono flex items-center pb-3 pt-0.5"),children:[" ","w"===S.turn()?"White turn":"Black turn"," "]}),(0,t.jsx)("div",{children:(0,t.jsx)(f.Z,{name:C,link:""})}),(0,t.jsx)(u.r,{id:n,onPieceDrop:v,boardOrientation:"b"===j?"black":"white",isDraggablePiece:function(e){return e.piece.startsWith(j)},position:N,customBoardStyle:{borderRadius:"8px",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.5)"},customSquareStyles:{...k.check}}),(0,t.jsx)("div",{children:(0,t.jsx)(f.Z,{name:null!=s?s:"Guest",link:""})})]})}),(0,t.jsx)("div",{className:"flex justify-center w-1/3",children:(0,t.jsx)("div",{children:y?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(d.Z,{moves:S.history({verbose:!0}).reverse(),bot:{id:"0",name:"shark"}}),(0,t.jsx)("div",{className:"flex gap-4 mt-4",children:(0,t.jsx)(m.z,{className:"w-full",onClick:()=>b(),children:"Forfeit"})})]}):null})}),"unknown"===g?null:(0,t.jsx)(h.Z,{winner:g,isOpen:p,setOpen:w})]})]})}}},function(e){e.O(0,[6227,3543,5279,7197,5408,9852,8623,3570,8813,1778,1328,298,3388,9736,1869,2970,8998,2290,2971,2472,1744],function(){return e(e.s=36106)}),_N_E=e.O()}]);